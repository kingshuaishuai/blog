# 一个前端的java后端之旅(四)理清简单而又复杂的注解
![](https://www.github.com/kingshuaishuai/static_resource/raw/master/assets/1584810370912.png)

又是一篇时隔很久的文章，这次来深入探究一下java中的注解，对于注解这个东西，它用起来就像注释，但它又可以实现很多功能，我一直感觉注解是个神秘而复杂的东西，在看过一些博客和书籍后，总感觉没有解除我心中的疑惑。注解到底是种怎样的技术，它的出现是为了解决什么样的问题，一个小小的像注释一样的注解到底是怎样实现想要的功能的。其实在学spring boot的过程中，更是体会到了接口的的强大，跟node、python比起来，它完全颠覆了常规的编程思维（虽说这种不同常规思维不是注解决定的，但在语法层面的表现就是各种注解的使用），接下来我们就一起研究一下java中神一般注解。

## 1 注解是什么？为什么会出现注解？
其实写到这里我还是在一直查资料，我并没有找到自己要的答案，注解是在怎样的背景下产生的，它到底解决了什么问题，那就让我们一起研究一下吧。

`注解在一定程度上是把元数据和源代码文件结合在一起的趋势所激发的，而不是保存在外部文档`首先来来看在[On Java 8 中文版 （java编程思想第五版）](https://lingcoder.gitee.io/onjava8/#/book/23-Annotations)中对注解的描述，我感觉这句话给出的信息量还是不少的，其中提到了`元数据和源代码的结合`以`及保存的外部文档`，结合在其他文章中的介绍：`注解是用于给Java代码附加元数据，可在编译时或运行时解析并处理这些元数据`来看，注解的本质就是元数据，那么新的问题又出现了，元数据又是什么？元数据与源代码之间可以有怎样的联系？

### 1.1 先来了解了一下元数据（meta data）
对于元数据，如果是计算机相关专业的同学，在数据库课本上可能会找到它的影子，但也可能已经没有什么印象，所谓的元数据我们经常都会接触到，那它到底是什么？官方的来讲，元数据是一种用来描述数据的数据，什么叫描述数据的数据？首先，它是一种数据，其次它的作用是用来描述其他数据的（说了等于没说），比如在一本书中，一定会有它的目录，通常我们会看到`目录`这两个字的下面会有详细的`第一章 xxxx`,`第二章 xxxx`,这里`目录`这两个字就是对下面具体目录信息的一种描述。

|元数据项目|元数据内容|
|----------|----------|
|书名|书具体的名字，如《重构 改善既有代码的设计》|
|出版社|中国工信出版集团 人民邮电出版社|
|作者|Martin fowler|
|目录|具体的目录信息|
|......|......|

对于上表来说，我们这里所说的元数据(meta data)其实就是第一列内容，它是对第二列具体内容的一个描述。

就上面`目录`来讲，我如果把它叫做`目录列表`,那`目录列表`就是一个元数据，这样不同的人可能会有不同的描述，因此，对于元数据而言，它也有自己的标准，在不同的行业中可能都会有自己的一套元数据标准，我们且不做深入讨论，但是在查资料的时候，`XML`映入了我的眼帘，`XML`也是一种元数据标准，特别是对于前端er们来讲，XML更不会陌生了，虽然我们并不写它，但是我写的HTML跟它比起来大同小异。为什么我偏偏把`XML`拿出来，现在的我们再去做Java Web的开发，可能就会像我一样直接学习spring boot了，我们可能不会经历配置大量XML结合java的历史（尽管还是会接触到XML），而XML相比于当前所要讨论的注解来说确实是一种非常冗长的东西，所以大胆推测，注解的出现一定程度上会与解决XML繁琐配置相关。

### 1.2 java代码与元数据的关系
说到这里我只是想说一说java与XML的关系，因为我没有经历过java的早期版本，也只能查查资料或者根据自己的想法，从表面上了解一些这种东西。java与XML是完全不同的两种东西，XML对于java来说，一般是作为配置文件来发挥自己的作用，XML可以描述各种各样的数据，java该如何与之结合呢，其实就前端而言，这个问题比较好理解，前端对于DOM的操作并不陌生，DOM的操作可以是通过javascript编程语言对HTML标记语言进行操作，当然也可以是java编程语言对XML这种标记语言进行操作，从而获取到自己需要的数据。其实自己随便网络上查一查java与XML，就会有一堆相关的资料，这里仅仅说明一下XML这种元数据与java的关系。

### 1.3 注解的作用
那么注解作为元数据，在根本上应该也可以为java提供数据的描述。再回过头来看看《On Java 8》的这句话`注解在一定程度上是把元数据和源代码文件结合在一起的趋势所激发的，而不是保存在外部文档`，注解作为java自身提供的一种元数据格式，可以直接写在代码里，而不是像XML一样是保存在java代码外部的文档，XML之所以只能保存在java代码外部，是因为它与java是两种东西，java是编程语言，而XML是标记语言，两者连最基本的属性都不同。但注解就不一样了，它是java语言的一部分，这样在java内部就有自己的一种元数据表达方式了，所以在一定程度上，它分担了最初XML所承担的一些事情，并且是native的。

### 1.4 对《On Java 8》中注解的描述的理解
这里我真的想再直接引入[《On Java 8》](https://lingcoder.gitee.io/onjava8/#/book/23-Annotations)的两段话，因为分析到这里我才明白这两段话讲的是什么意思，想了想还是直接拿过来大家也看看吧，如果有时间也可以自己去看看这本书。

> 注解（也被称为元数据）为我们在代码中添加信息提供了一种形式化的方式，使我们可以在稍后的某个时刻更容易的使用这些数据。

> 注解在一定程度上是把元数据和源代码文件结合在一起的趋势所激发的，而不是保存在外部文档。这同样是对像 C# 语言对于 Java 语言特性压力的一种回应。

> 注解是 Java 5 所引入的众多语言变化之一。它们提供了 Java 无法表达的但是你需要完整表述程序所需的信息。`因此，注解使得我们可以以编译器验证的格式存储程序的额外信息。注解可以生成描述符文件，甚至是新的类定义，并且有助于减轻编写“样板”代码的负担。通过使用注解，你可以将元数据保存在 Java 源代码中。并拥有如下有下优势：简单易读的代码，编译器类型检查，使用 annotation API 为自己的注解构造处理工具。即使 Java 定义了一些类型的元数据，但是一般来说注解类型的添加和如何使用完全取决于你。`

对于上面这段话中进行标记的从因此开始的部分，我再做一下自己理解的描述，这里告诉我们注解在java的内部帮助我们存储了一些额外数据信息，这些数据可以通过java内部工具进行处理后生成一些描述符，也就是通过简单的标记，java内部就可以帮我们生成一些正常的java代码，而这些简单的标记（也就是注解）使得我们在写java语言的时候可以更加简洁方便。作为前端，如果你了解`ejs`模板，那么你可能会有更深的体会，使用`ejs`模板引擎不仅可以帮我们生成html代码，如果你愿意，甚至可以用它来生成一些动态的js文件，比如阿里的`umi`框架，以可拔插的插件为特色，其中原理就是使用了`ejs`。

> 每当创建涉及重复工作的类或接口时，你通常可以使用注解来自动化和简化流程。例如在 Enterprise JavaBean（EJB）中的许多额外工作就是通过注解来消除的。

其实到目前为止，我对于java中Bean的概念还没有什么了解，但是在spring boot的学习中（我学的慕课网java全栈大课），七月老师一直提到一个东西叫做Bean，并且有个@Bean的注解一直出现，然而我还是不太理解Bean，通过上面这段描述，那我可以猜测java中Bean的定义应该与XML和注解有很大的关系，在之前查资料时候就发现了注解和Bean有着不可分的关系，对于Bean在后面会单独写文章来描述的，毕竟我自己对它感觉很是懵逼。

> 注解的出现可以替代一些现有的系统，例如 XDoclet，它是一种独立的文档化工具，专门设计用来生成注解风格的文档。与之相比，注解是真正语言层级的概念，以前构造出来就享有编译器的类型检查保护。注解在源代码级别保存所有信息而不是通过注释文字，这使得代码更加整洁和便于维护。通过使用拓展的 annotation API 或稍后在本章节可以看到的外部的字节码工具类库，你会拥有对源代码及字节码强大的检查与操作能力。

为什么还要贴出这段话，在这段中，有个工具叫做`XDoclet`，如果有兴趣，你百度一下就会发现，这个工具就是java中处理XML的一个工具，这里说注解的出现可以代替一些工具，其中包含了XDoclet,这就证明我们在上面的猜测中，注解的出现一定程度上会与解决XML繁琐配置相关是正确的。并且它也告诉了我们注解的作用，它是更加native的语法，java中提供了相关api供我们使用，我们甚至可以拥有对源码和字节码的操作能力。

### 1.5 本节小结
这一节可能有点长，但其实我也是在边写文章边分析的时候才真的放下心中对注解的这块石头，如果你仔细阅读到这里，那你肯定可以回答题目中的两个问题了，简单来说，注解就是一种元数据（这么官方的话突然它就不官方了），是一种java内部实现的元数据可以在一定程度上代替掉XML这种外部保存类型的元数据，作用就是比xml更加简洁，更native，属于java这个编程语言的一部分而不是像XML一样完全不同于java，并且它能够在内部为我们生成java代码我们只需要使用简单的语法即可，java提供的annotation API甚至能够让我们拥有对源码及字节码的检查与操作能力。

## 2 java中关于注解的使用
这里的内容就差不多就是语法层面了，也就是大家在网上可以随便搜就能搜到的，但是还是要拿出来说一说，这样心里才能踏实点。

### 2.1 注解的工作方式

先上一张图annotation
![enter description here](https://www.github.com/kingshuaishuai/static_resource/raw/master/assets/1584861118668.png)

java中我们要使用注解，大致要做的就是上面这三件事情了，首先是要进行注解的定义，在定义注解后，才能使用自己定义的注解，最后定义的注解到底是怎样工作，怎样实现自己功能的，这就到注解解释器的部分了，通过编写注解解释器，可以自定义自己的逻辑，生成最终自己想要的信息。这样看来，注解并不像只有使用起来简单，真正有技术含量的部分还是在于注解解释器，这才是实现你想要的功能的核心。在接触java的过程中，也听到过很多人说XXX功能的原理就是使用某某注解和某某注解，但也不说明其真正的原理，我也是一直疑惑，现在来看，他们的回答并不准确，真正的原理部分其实在于注解解释器部分的业务逻辑。

### 2.2 注解的定义方式

**元注解**
在正式说明注解的定义方式之前，我必须先说明另外一个东西，那就是`元注解(meta annotation)`。在上文中我们了解过元数据，是用来描述数据的一种数据，那么元注解也类似，是用来注解其他注解的注解，这样说还是太官方了，其实就是java语言本身已经为我们定义好的一些注解，我们可以依靠它们来定义我们自己的注解。

在java5中，提供了四种元注解，java8中又新增了一种，详情请看下表（摘抄自《On Java 8》）

|注解|解释|
|----|----|
|@Target|表示注解可以用于哪些地方。可能的 ElementType 参数包括:<br>`CONSTRUCTOR`：构造器的声明<br/>`FIELD`：字段声明（包括 enum 实例）<br/>`LOCAL_VARIABLE`：局部变量声明<br/>`METHOD`：方法声明<br/>`PACKAGE`：包声明<br/>`PARAMETER`：参数声明<br/>`TYPE`：类、接口（包括注解类型）或者 enum 声明|
|@Retention|表示注解信息保存的时长。可选的 RetentionPolicy 参数包括：<br/>`SOURCE`：注解将被编译器丢弃<br/>`CLASS`：注解在 class 文件中可用，但是会被 VM 丢弃。<br/>`RUNTIME`：VM 将在运行期也保留注解，因此可以通过反射机制读取注解的信息。|
|@Documented|将此注解保存在 Javadoc 中|
|@Inherited|允许子类继承父类的注解|
|@Repeatable|允许一个注解可以被使用一次或者多次（Java 8）。|